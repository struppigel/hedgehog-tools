# move_callers_to_malware.py
from ghidra.program.model.symbol import SourceType

addr = askAddress("Function address", "Enter function address:")
target = getFunctionAt(addr)
if not target:
    print("No function at", addr); exit()

symtab = currentProgram.getSymbolTable()
global_ns = currentProgram.getGlobalNamespace()
ns = symtab.getNamespace("malware", global_ns)
if ns is None:
    ns = symtab.createNameSpace(global_ns, "malware", SourceType.USER_DEFINED)

seen = set()
for ref in getReferencesTo(target.getEntryPoint()):
    caller = getFunctionContaining(ref.getFromAddress())
    if caller and caller.getEntryPoint() not in seen:
        seen.add(caller.getEntryPoint())
        caller.setParentNamespace(ns)
        print("Moved:", caller.getName())

print("Done. Moved", len(seen), "functions.")
